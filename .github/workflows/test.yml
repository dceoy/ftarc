---
name: Python package tests
on:
  workflow_call:
    inputs:
      uv-version:
        required: false
        type: string
        description: Version of uv to use
        default: latest
      runs-on:
        required: false
        type: string
        description: Runner to use
        default: ubuntu-latest
  workflow_dispatch:
    inputs:
      uv-version:
        required: false
        type: string
        description: Version of uv to use
        default: latest
      runs-on:
        required: false
        type: string
        description: Runner to use
        default: ubuntu-latest
defaults:
  run:
    shell: bash -euo pipefail {0}
    working-directory: .
jobs:
  unit-tests:
    uses: dceoy/gh-actions-for-devops/.github/workflows/python-package-test.yml@main
    with:
      package-path: .
      uv-version: ${{ inputs.uv-version }}
      runs-on: ${{ inputs.runs-on }}
  cli-tests:
    runs-on: ${{ inputs.runs-on }}
    steps:
      - name: Checkout repository
        uses: actions/checkout@692973e3d937129bcbf40652eb9f2f61becf3332  # v4.1.7
      - name: Set up uv
        uses: astral-sh/setup-uv@d9e0f98d3fc6adb07d1e3d37f3043649ddad06a1  # v6.5.0
        with:
          version: ${{ inputs.uv-version || 'latest' }}
      - name: Install package
        run: |
          uv sync --all-extras
      - name: Test CLI commands
        run: |
          uv run ftarc --version
          uv run ftarc --help
          uv run ftarc init
          uv run ftarc init --yml ftarc-test.yml
          test -f ftarc-test.yml