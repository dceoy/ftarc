---
name: Python package tests
on:
  workflow_call:
    inputs:
      uv-version:
        required: false
        type: string
        description: Version of uv to use
        default: latest
      runs-on:
        required: false
        type: string
        description: Runner to use
        default: ubuntu-latest
  workflow_dispatch:
    inputs:
      uv-version:
        required: false
        type: string
        description: Version of uv to use
        default: latest
      runs-on:
        required: false
        type: string
        description: Runner to use
        default: ubuntu-latest
defaults:
  run:
    shell: bash -euo pipefail {0}
    working-directory: .
jobs:
  unit-tests:
    uses: dceoy/gh-actions-for-devops/.github/workflows/python-package-test.yml@main
    with:
      package-path: .
      uv-version: ${{ inputs.uv-version }}
      runs-on: ${{ inputs.runs-on }}
  cli-tests:
    runs-on: ${{ inputs.runs-on }}
    steps:
      - name: Checkout repository
        uses: actions/checkout@08c6903cd8c0fde910a37f88322edcfb5dd907a8  # v5.0.0
      - name: Set up uv
        uses: astral-sh/setup-uv@5a7eac68fb9809dea845d802897dc5c723910fa3  # v7.1.3
        with:
          version: ${{ inputs.uv-version || 'latest' }}
      - name: Install package
        run: |
          uv sync
      - name: Test CLI commands
        run: |
          uv run ftarc --version
          uv run ftarc --help
          uv run ftarc init
          uv run ftarc init --yml ftarc-test.yml
          test -f ftarc-test.yml
