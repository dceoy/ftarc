---
name: Python package tests
on:
  workflow_call:
    inputs:
      uv-version:
        required: false
        type: string
        description: Version of uv to use
        default: latest
      runs-on:
        required: false
        type: string
        description: Runner to use
        default: ubuntu-latest
  workflow_dispatch:
    inputs:
      uv-version:
        required: false
        type: string
        description: Version of uv to use
        default: latest
      runs-on:
        required: false
        type: string
        description: Runner to use
        default: ubuntu-latest
defaults:
  run:
    shell: bash -euo pipefail {0}
    working-directory: .
jobs:
  unit-tests:
    uses: dceoy/gh-actions-for-devops/.github/workflows/python-package-test.yml@main
    with:
      package-path: .
      uv-version: ${{ inputs.uv-version }}
      runs-on: ${{ inputs.runs-on }}
  cli-tests:
    runs-on: ${{ inputs.runs-on }}
    steps:
      - name: Checkout repository
        uses: actions/checkout@8e8c483db84b4bee98b60c0593521ed34d9990e8  # v6.0.1
      - name: Set up uv
        uses: astral-sh/setup-uv@681c641aba71e4a1c380be3ab5e12ad51f415867  # v7.1.6
        with:
          version: ${{ inputs.uv-version || 'latest' }}
      - name: Install package
        run: |
          uv sync
      - name: Test CLI commands
        run: |
          uv run ftarc --version
          uv run ftarc --help
          uv run ftarc init
          uv run ftarc init --yml ftarc-test.yml
          test -f ftarc-test.yml
